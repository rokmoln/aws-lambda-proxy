{"version":3,"sources":["../src/log.js"],"names":[],"mappings":"mHAAA;AACA;AACA;AACA;;AAEA,gC;;;;;;;AAOA,IAAI,IAAI,GAAG,IAAI,cAAJ,CAAW;AACpB,EAAA,WAAW,EAAE;AACX,uBADW;AAEX,sBAFW;AAGX,kBAAe,EAAC,KAAD,EAAQ,OAAR,EAAiB,SAAjB,EAAf,EAA4C;AAC1C,6BAAE,KAAF,CAAQ,KAAR,EAAe;AACb,MAAA,IAAI,EAAE,iBAAI,IADG,EAAf;;;AAIA,WAAO,KAAP;AACD,GATU,CADO;;AAYpB,EAAA,SAAS,EAAE;AACT,4BAAa;AACX,IAAA,KAAK,EAAE,yBAAE,SAAF,CAAY,aAAI,GAAJ,CAAQ,KAApB,EAA2B,OAA3B,CADI,EAAb,CADS,CAZS,EAAX,CAAX,C;;;;;AAmBA,IAAI,CAAC,iBAAQ,QAAb,EAAuB;AACrB,iBAAA,IAAI,GAAG,aAAK,KAAL,CAAW;AAChB,IAAA,WAAW,EAAE;AACX,oBAAe,EAAC,KAAD,EAAQ,OAAR,EAAiB,SAAjB,EAAf,EAA4C;AAC1C,+BAAE,KAAF,CAAQ,KAAR,EAAe;AACb,QAAA,eAAe,EAAE,IADJ;AAEb,QAAA,QAAQ,EAAE,yBAAE,GAAF,CAAM,gBAAN,EAAe,WAAf,EAA4B,GAA5B,CAFG,EAAf;;;AAKA,aAAO,KAAP;AACD,KARU,CADG,EAAX,CAAP;;;AAYD,C","file":"log.js","sourcesContent":["import _ from 'lodash-firecloud';\nimport cluster from 'cluster';\nimport env from './env';\nimport pkg from '../package.json';\n\nimport {\n  MinLog,\n  logToConsole,\n  serializeErr,\n  serializeTime\n} from 'minlog';\n\nlet _log = new MinLog({\n  serializers: [\n    serializeTime,\n    serializeErr,\n    async function({entry, _logger, _rawEntry}) {\n      _.merge(entry, {\n        name: pkg.name\n      });\n\n      return entry;\n    }\n  ],\n  listeners: [\n    logToConsole({\n      level: _.defaultTo(env.log.level, 'TRACE')\n    })\n  ]\n});\n\nif (!cluster.isMaster) {\n  _log = _log.child({\n    serializers: [\n      async function({entry, _logger, _rawEntry}) {\n        _.merge(entry, {\n          tagServerWorker: true,\n          workerId: _.get(cluster, 'worker.id', 'M')\n        });\n\n        return entry;\n      }\n    ]\n  });\n}\n\nexport default _log;\n"]}